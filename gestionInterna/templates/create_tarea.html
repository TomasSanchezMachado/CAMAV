{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">Pedido #{{ pedido.id }}</h4>
      <small>Cliente: {{ pedido.cliente.nombre }}</small>
    </div>
    <div class="card-body">
      <h5 class="mb-3">Operarios Disponibles</h5>
      <ul class="list-group mb-3">
        {% for operario in operarios %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <span>{{ operario.nombre }} {{ operario.apellido }}</span>
          <span class="badge bg-info">Legajo: {{ operario.legajo }}</span>
        </li>
        {% empty %}
        <li class="list-group-item text-muted">No hay operarios registrados.</li>
        {% endfor %}
      </ul>

      <form method="post" class="mb-4">
        {% csrf_token %}
        <input type="hidden" name="accion" value="buscar" />
        <div class="mb-3">
          <label for="nroSerieamortiguador" class="form-label">Número de Serie</label>
          <input
            type="number"
            name="nroSerieamortiguador"
            id="nroSerieamortiguador"
            value="{{ nroSerieamortiguador }}"
            class="form-control"
            required
          />
        </div>
        <button type="submit" class="btn btn-primary w-100">Buscar</button>
      </form>

      {% if amortiguador %}
      <div class="alert alert-info">
        <p class="mb-0">Amortiguador encontrado: {{ amortiguador.nroSerieamortiguador }}</p>
      </div>
      <form action="" method="post">
        {% csrf_token %}
        <input type="hidden" name="accion" value="crear_tarea" />
        <input type="hidden" name="id_amortiguador" value="{{ amortiguador.id }}">
        <div class="card mb-3">
          <div class="card-body">
            <h5 class="card-title">Detalles de la Tarea</h5>
            <div class="mb-3">
              <label for="operario" class="form-label">Operario</label>
              <select name="operario" id="operario" class="form-select" required>
                {% for op in operarios %}
                <option value="{{ op.id }}">{{ op.nombre }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-3">
              <label for="prioridad" class="form-label">Prioridad</label>
              <select name="prioridad" id="prioridad" class="form-select" required>
                <option value="alta">Alta</option>
                <option value="media">Media</option>
                <option value="baja">Baja</option>
              </select>
            </div>
            <button type="submit" class="btn btn-success w-100">Crear Tarea</button>
          </div>
        </div>
      </form>
      {% endif %}

      {% if no_amortiguador %}
      <div class="alert alert-warning">
        <p class="mb-0">No se encontró el amortiguador.</p>
      </div>
      <form action="" method="post">
        {% csrf_token %}
        <input type="hidden" name="accion" value="crear_amortiguador_tarea" />
        <div class="card mb-3">
          <div class="card-body">
            <h5 class="card-title">Detalles del Amortiguador</h5>
            <div class="mb-3">
              <label for="nroSerieamortiguador" class="form-label">Número de Serie</label>
              <input
                type="number"
                name="nroSerieamortiguador"
                id="nroSerieamortiguador"
                value="{{ nroSerieamortiguador }}"
                class="form-control"
                required
              />
            </div>
            <div class="mb-3">
              <label for="tipo_amortiguador" class="form-label">Tipo de Amortiguador</label>
              <select
                name="tipo_amortiguador"
                id="tipo_amortiguador"
                class="form-select"
                required
              >
                <option value="normal">Normal</option>
                <option value="carrera">Carrera</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="ficha_amortiguador" class="form-label">Ficha Técnica</label>
              <select
                name="ficha_amortiguador"
                id="ficha_amortiguador"
                class="form-select"
                required
              >
                <option value="">Seleccione una ficha...</option>
                {% for ficha in fichas %}
                <option value="{{ ficha.id }}">
                  {{ ficha.nroseriegenerico }} - {{ ficha.nombregenerico }}
                </option>
                {% endfor %}
              </select>
            </div>
            <div class="card-title bg-dark text-light h4">Detalles Tarea:</div>
            <div class="mb-3">
              <label for="operario" class="form-label">Operario</label>
              <select name="operario" id="operario" class="form-select" required>
                {% for op in operarios %}
                <option value="{{ op.id }}">{{ op.nombre }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-3">
              <label for="prioridad" class="form-label">Prioridad</label>
              <select name="prioridad" id="prioridad" class="form-select" required>
                <option value="alta">Alta</option>
                <option value="media">Media</option>
                <option value="baja">Baja</option>
              </select>
            </div>
            <button type="submit" class="btn btn-success w-100">Crear Amortiguador y Tarea</button>
          </div>
        </div>
      </form>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
