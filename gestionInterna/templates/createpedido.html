{% extends 'base.html' %} {% block content %}

<div class="container mt-5">
  <h2>Crear Pedido</h2>

  <!-- Formulario 1: Buscar cliente por DNI -->
  <form method="post" class="mb-4">
    {% csrf_token %}
    <input type="hidden" name="accion" value="buscar_cliente" />
    <div class="mb-3">
      <label for="dni">DNI del cliente</label>
      <input
        type="text"
        name="dni"
        id="dni"
        class="form-control"
        value="{{ dni }}"
        {%
        if
        dni
        %}readonly{%
        endif
        %}
        required
      />
    </div>
    <button
      type="submit"
      class="btn btn-primary"
      {%
      if
      dni
      %}disabled{%
      endif
      %}
    >
      Buscar cliente
    </button>
  </form>

  {% if cliente %}
  <div class="alert alert-success">
    Cliente encontrado:
    <strong>{{ cliente.nombre }} {{ cliente.apellido }}</strong>
  </div>

  <!-- Formulario 2: Crear pedido -->
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="accion" value="crear_pedido" />
    <input type="hidden" name="dni" value="{{ cliente.dni }}" />
    <div class="mb-3">
      <label for="fecha">Fecha estimada de salida</label>
      <input
        type="date"
        name="fecha"
        id="fecha"
        class="form-control"
        value="{{ fecha }}"
        {%
        if
        pedido
        %}readonly{%
        endif
        %}
        required
      />
    </div>
    <button
      type="submit"
      class="btn btn-success"
      {%
      if
      pedido
      %}disabled{%
      endif
      %}
    >
      Crear pedido
    </button>
  </form>
  {% elif dni %}
  <div class="alert alert-warning">
    No se encontró ningún cliente con el DNI <strong>{{ dni }}</strong>.
  </div>
  <!-- Formulario 3: Crear cliente y pedido -->
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="accion" value="crear_cliente" />
    <input type="hidden" name="dni" value="{{ dni }}" />
    <div class="mb-3">
      <label for="nombre">nombre del cliente</label>
      <input
        type="text"
        name="nombre"
        id="nombre"
        class="form-control"
        value="{{ nombre }}"
        {%
        if
        pedido
        %}readonly{%
        endif
        %}
        required
      />
      <label for="apellido">apellido del cliente</label>
      <input
        type="text"
        name="apellido"
        id="apellido"
        class="form-control"
        value="{{ apellido }}"
        {%
        if
        pedido
        %}readonly{%
        endif
        %}
        required
      />
      <label for="correo">correo del cliente</label>
      <input
        type="text"
        name="correo"
        id="correo"
        class="form-control"
        value="{{ correo }}"
        {%
        if
        pedido
        %}readonly{%
        endif
        %}
        required
      />
      <label for="telefono">telefono del cliente</label>
      <input
        type="text"
        name="telefono"
        id="telefono"
        class="form-control"
        value="{{ telefono }}"
        {%
        if
        pedido
        %}readonly{%
        endif
        %}
        required
      />
      <label for="fecha">Fecha estimada de salida</label>
      <input
        type="date"
        name="fecha"
        id="fecha"
        class="form-control"
        value="{{ fecha }}"
        {%
        if
        pedido
        %}readonly{%
        endif
        %}
        required
      />
    </div>
    <button
      type="submit"
      class="btn btn-primary"
      {%
      if
      pedido
      %}disabled{%
      endif
      %}
    >
      Crear pedido
    </button>
  </form>
  {% endif %} {% if pedido %}
  <hr />
  <div class="alert alert-info">
    Pedido creado correctamente para <strong>{{ cliente.nombre }}</strong>.
    <a
      href="/agregar/tarea/?pedido_id={{ pedido.id }}"
      class="btn btn-secondary mt-2"
      >Agregar tareas</a
    >
  </div>
  {% endif %}
</div>
{% endblock %}
